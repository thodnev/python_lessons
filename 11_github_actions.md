## Настройка GitHub Action для автосборки проекта и выкладывания в Releases

#### Базовые GitHub Actions
Есть официальные GitHub Action - скрипты для сборки релизов:
- https://github.com/actions/create-release
- https://github.com/actions/upload-release-asset

Однако, они устарели (дата последнего обновления - 2021 год).
В описании видим, что из-за наличия большого количества более популярных альтернатив,
рекомендуется использовать именно их.
В частности, во втором репозитории видим ссылку на сторонний action
[softprops/action-gh-release](https://github.com/softprops/action-gh-release).
Его и будем использовать далее.

#### Сборка

У нас вся сборка заключается в выполнении скрипта `bindownload.py`, который загрузит бинарные артефакты и проверит их хеш-суммы.
Затем мы хотим сложить все что получилось в итоге в архив, который и будет расспространяться
как результат сборки.


#### Подготовка к архивации билда

Мы хотим положить в релизы архив, который содержит результат сборки.
Этот архив должен по возможности быть универсальным и открываться везде.

Для сжатия можем использовать zip. Он портативный (в отличии от таких форматов, как .tar.gz или .rar).

**Очень важно** не забывать исключать хотя-бы директорию `.git`. Это популярная проблема, когда
ее оставляют в релизе и, в итоге, размер в распакованном виде практически удваивается.

Например, чтобы сжать текущую директорию с максимальной компрессией,
исключая субдиректории `.git` и `.github`:

`zip -9 -x '.git/*' -x '.github/*' -r release.zip .`

Более современный вариант (с использованием алгоритма bzip2), **но** такой архив
откроется только на linux-системах или там, где есть не родной архиватор (по типу WinRar для Windows):

`zip -Z bzip2 -9 -x '.git/*' -x '.github/*' -r release.zip .`

#### Альтернативные форматы
- Пример архивации в tar.xz (с экстремальной компрессией):
  `XZ_OPT=-9e tar -cf release.tar.xz --xz --exclude=lostyas_tag/.git lostyas_tag/`

  Размер файла на выходе: 86.4 МБ
- Сжатие с максимальной компрессией обычным ZIP:
  `zip -v -9 --exclude='.git/*' -r ../release.zip .`

  Размер файла на выходе: 108.2 МБ


### Other
Получить название репозитория можно с помощью sed из `github.repository`:
`echo 'octocat/Hello-World' | sed 's/[^/]*[/]//'`
Или с помощью python:
`echo 'one/two' | python -c 'r=input();r=r.split("/");r=r[-1];print(r)'`



#### Тегирование релизов

Когда мы подготовили релиз, мы можем описать его (в текущей конфигурации) в `CHANGELOG.md`. Текст релиза будет браться из этого файла

Затем мы тегаем релиз:
- Тег с аннотацией (редкость):
  `git tag -a v0.0.1-1 -m "My message for git tag" [COMMIT_HASH]`
- Тег без аннотации:
  `git tag v0.0.1-1 [COMMIT_HASH]`

Чтобы выложить теги на удаленный сервер есть свитч `--tags`:
`git push origin --tags`


